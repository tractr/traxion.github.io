"use strict";(self.webpackChunk_trxn_traxion_api=self.webpackChunk_trxn_traxion_api||[]).push([[73],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var o=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(n),u=i,h=p["".concat(l,".").concat(u)]||p[u]||m[u]||a;return n?o.createElement(h,r(r({ref:t},d),{},{components:n})):o.createElement(h,r({ref:t},d))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,r=new Array(a);r[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:i,r[1]=s;for(var c=2;c<a;c++)r[c]=n[c];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},7090:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>c,toc:()=>p});var o=n(7462),i=n(3366),a=(n(7294),n(3905)),r=["components"],s={id:"use-minio",title:"Use Minio in development to mock AWS S3",sidebar_label:"Use Minio to mock AWS S3"},l=void 0,c={unversionedId:"how-to/file-storage/use-minio",id:"how-to/file-storage/use-minio",title:"Use Minio in development to mock AWS S3",description:"Why use Minio in development",source:"@site/docs/how-to/file-storage/use-minio.md",sourceDirName:"how-to/file-storage",slug:"/how-to/file-storage/use-minio",permalink:"/docs/how-to/file-storage/use-minio",draft:!1,editUrl:"https://github.com/tractr/traxion/tree/main/apps/docs/docs/how-to/file-storage/use-minio.md",tags:[],version:"current",frontMatter:{id:"use-minio",title:"Use Minio in development to mock AWS S3",sidebar_label:"Use Minio to mock AWS S3"},sidebar:"documentation",previous:{title:"File Storage on AWS S3",permalink:"/docs/how-to/file-storage/file-storage-on-aws-s3"},next:{title:"Introduction",permalink:"/docs/how-to/terraform/introduction"}},d={},p=[{value:"Why use Minio in development",id:"why-use-minio-in-development",level:2},{value:"Add a Minio service to the existing <code>docker-compose.yml</code>.",id:"add-a-minio-service-to-the-existing-docker-composeyml",level:2},{value:"Update the environment file with the required variables",id:"update-the-environment-file-with-the-required-variables",level:2},{value:"Configuring Minio via the web console",id:"configuring-minio-via-the-web-console",level:2}],m={toc:p};function u(e){var t=e.components,s=(0,i.Z)(e,r);return(0,a.kt)("wrapper",(0,o.Z)({},m,s,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"why-use-minio-in-development"},"Why use Minio in development"),(0,a.kt)("p",null,"When developing an application that requires file storage, we typically rely on the AWS S3 service which provides a cloud-based solution to host a file storage service for storage and production environments."),(0,a.kt)("p",null,"However, this is not a viable solution for development, as it would require creating an AWS S3 bucket, which would not be convenient."),(0,a.kt)("p",null,"A better solution is to use ",(0,a.kt)("a",{parentName:"p",href:"https://min.io/"},"Minio"),", which is an S3 compatible file storage software."),(0,a.kt)("p",null,"Usually, we use ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-compose")," to run third-party software that is needed in a development environment (databases, message brokers, stores...). Minio provides an ",(0,a.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/minio/minio"},"official docker image")," on docker-hub."),(0,a.kt)("h2",{id:"add-a-minio-service-to-the-existing-docker-composeyml"},"Add a Minio service to the existing ",(0,a.kt)("inlineCode",{parentName:"h2"},"docker-compose.yml"),"."),(0,a.kt)("p",null,"To add Minio to an existing ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," file, simply edit the file to create a new service and associated volume:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"version: '3'\n\nservices:\n  # ..............\n\n  # ADD THE FILE STORAGE SERVICE\n  #------------------------------------------------\n  # File storage\n  #------------------------------------------------\n  minio:\n    image: minio/minio\n    # '--console-address' param starts a web console which is useful to manage the store in development\n    command: server /data --console-address:9001\n    ports:\n      # Bind the minio serviec to port 9000. It can be accessed to http://localhost:900\n      - \"${FILE_STORAGE_PORT:-9000}:9000\"\n      # Bind the web console to port 9001. It can be accessed at http://localhost:9001\n      - \"9001:9001\"\n    environment:\n      # Environment variable are used to pass credentials to initialize a root user\n      # Those variables should be defined in a '.env' file at the root of the repo\n      MINIO_ROOT_USER: ${FILE_STORAGE_ACCESS_KEY}\n      MINIO_ROOT_PASSWORD: ${FILE_STORAGE_SECRET_KEY}\n    volumes:\n      - s3-data:/data\n\nvolumes:\n  # ..............\n  # ADD A VOLUME ASSOCIATED TO THE FILE STORAGE SERVICE\n  s3-data:\n")),(0,a.kt)("h2",{id:"update-the-environment-file-with-the-required-variables"},"Update the environment file with the required variables"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," file uses environment variables. When starting containers, Docker will automatically load a ",(0,a.kt)("inlineCode",{parentName:"p"},".env")," file if it exists."),(0,a.kt)("p",null,"You need to update this ",(0,a.kt)("inlineCode",{parentName:"p"},". env")," file to provide environment variables needed by the Minio service:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"#---------------------------------------\n# File storage\n#---------------------------------------\n\n# Username required to log into the Minio console.\nFILE_STORAGE_ACCESS_KEY=minio\n\n# Password required to connect to the Minio console\nFILE_STORAGE_SECRET_KEY=password\n\n# (Optionnal) Overrides the port for the Minio service\nFILE_STORAGE_PORT=9000\n\n# Used by the API to connect to the Minio bucket\nFILE_STORAGE_DEFAULT_BUCKET=bucket\n\n# Used by the API to connect to the Minio bucket\nFILE_STORAGE_ENDPOINT=localhost\n\n# Used by the API to connect to Minio\n# It should be set at false as there is no SSL certificate in development\nFILE_STORAGE_USE_SSL=false\n")),(0,a.kt)("h2",{id:"configuring-minio-via-the-web-console"},"Configuring Minio via the web console"),(0,a.kt)("p",null,"When you first run the Minio container (usually with `docker-compose up -d), Minio will create a root user with the credentials provided by the environment variables."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"However, it will not create a bucket!"),"."),(0,a.kt)("p",null,"To create a bucket, once the Minio container is running, go to ",(0,a.kt)("a",{parentName:"p",href:"http://localhost:9001"},"http://localhost:9001")," ",(0,a.kt)("strong",{parentName:"p"},"(use the web console port, not the Minio api port!)"),"."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Minio login",src:n(4927).Z,width:"1859",height:"983"})),(0,a.kt)("p",null,"Use the credentials from the ",(0,a.kt)("inlineCode",{parentName:"p"},".env")," file."),(0,a.kt)("admonition",{type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"if you start the minio container for the first time without the credentials in the environment variable,\nit will create a root user with default credentials ",(0,a.kt)("inlineCode",{parentName:"p"},"minioadmin:minioadmin"),"."),(0,a.kt)("p",{parentName:"admonition"},"You will see this message in the Minio container's logs:"),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-text"},"WARNING: Detected default credentials 'minioadmin:minioadmin', we recommend that you change these values with 'MINIO_ROOT_USER' and 'MINIO_ROOT_PASSWORD' environment variables\n")),(0,a.kt)("p",{parentName:"admonition"},"To reset the root user's password you will have to remove the Minio's volume and restart the container."),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"docker-compose down\ndocker volume rm <volume-name>\ndocker-compose up -d\n"))),(0,a.kt)("p",null,"Once connected, you need to create a bucket."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Minio bucket create 1",src:n(9870).Z,width:"1880",height:"998"})),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Minio bucket create 2",src:n(4481).Z,width:"1880",height:"998"})),(0,a.kt)("p",null,"The name of the bucket must match the name declared in the environment variable, otherwise the Minio client will not be able to connect."),(0,a.kt)("p",null,"Once the bucket is created you should land on this page:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Minio bucket details",src:n(8842).Z,width:"1880",height:"998"})),(0,a.kt)("p",null,"From here you can upload new files to the bucket"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Minio bucket upload",src:n(9134).Z,width:"1880",height:"998"})),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"However, please note that buckets are created with a restricted policy by default!")),(0,a.kt)("p",null,"If you request the file from Minio without credentials (for example ",(0,a.kt)("inlineCode",{parentName:"p"},"http://localhost:9000/bucket/forest.jpg"),"), access will be denied."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Minio access denied",src:n(375).Z,width:"1881",height:"995"})),(0,a.kt)("p",null,"To change the bucket policy from private to public (depending on the business logic of the project you are working on), go to the bucket list and click on the ",(0,a.kt)("em",{parentName:"p"},"manage")," button of your bucket."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Minio bucket manage",src:n(1214).Z,width:"1889",height:"991"})),(0,a.kt)("p",null,"Then select the new policy."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Minio policy",src:n(3179).Z,width:"1880",height:"1007"})),(0,a.kt)("p",null,"That\u2019s it! You should be ready to work on a local environment by using Minio instead of AWS S3!"))}u.isMDXComponent=!0},4927:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/minio-0-ad068cd3eca5999031d19327d1977e58.png"},9870:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/minio-1-7aabe3461475df6c969d0431455de88b.png"},4481:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/minio-2-7aabe3461475df6c969d0431455de88b.png"},8842:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/minio-3-7aabe3461475df6c969d0431455de88b.png"},9134:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/minio-4-7aabe3461475df6c969d0431455de88b.png"},375:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/minio-5-7977b22573598ebd71b734225041a26e.png"},1214:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/minio-6-288c354eb19f0c88f05acbb334d370c5.png"},3179:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/minio-7-a7d09af6a7ebca82e3568fe0cd1b4d39.png"}}]);