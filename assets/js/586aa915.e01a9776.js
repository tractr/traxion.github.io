"use strict";(self.webpackChunk_trxn_traxion_api=self.webpackChunk_trxn_traxion_api||[]).push([[6],{253:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>d,toc:()=>p});var r=n(7896),a=n(1461),i=(n(2784),n(876)),o=["components"],l={id:"prisma-configuration",title:"Prisma Configuration",sidebar_label:"Prisma Configuration"},s=void 0,d={unversionedId:"Overview/prisma-configuration",id:"Overview/prisma-configuration",title:"Prisma Configuration",description:"Traxion generators offer customization through the parameterization of Prisma. This utilizes what we call metadata directly within the Prisma schema.",source:"@site/docs/01-Overview/03-configuration-prisma.md",sourceDirName:"01-Overview",slug:"/Overview/prisma-configuration",permalink:"/Overview/prisma-configuration",draft:!1,editUrl:"https://github.com/tractr/traxion/tree/main/apps/docs/docs/01-Overview/03-configuration-prisma.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{id:"prisma-configuration",title:"Prisma Configuration",sidebar_label:"Prisma Configuration"},sidebar:"mySidebar",previous:{title:"Getting started",permalink:"/"},next:{title:"GraphQL API",permalink:"/graphql-api/"}},u={},p=[{value:"Metadata",id:"metadata",level:2},{value:"User Singularity",id:"user-singularity",level:2},{value:"User Discovery",id:"user-discovery",level:2},{value:"Ownership",id:"ownership",level:2},{value:"Read, Write, Delete Authorization",id:"read-write-delete-authorization",level:2},{value:"Hidden and Encrypted Fields",id:"hidden-and-encrypted-fields",level:2}],c={toc:p},m="wrapper";function h(e){var t=e.components,n=(0,a.Z)(e,o);return(0,i.kt)(m,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Traxion generators offer customization through the parameterization of Prisma. This utilizes what we call metadata directly within the Prisma schema."),(0,i.kt)("h2",{id:"metadata"},"Metadata"),(0,i.kt)("p",null,"A Traxion metadata is a Prisma comment that begins with three ",(0,i.kt)("inlineCode",{parentName:"p"},"/"),". Traxion employs a convention of namespacing these metadata to avoid interference with other generators using the same system. Thus, you can add as many metadata before a model or field."),(0,i.kt)("p",null,"All metadata beginning with ",(0,i.kt)("inlineCode",{parentName:"p"},"/// @trxn/")," will be interpreted by Traxion. Anything else is considered as documentation."),(0,i.kt)("h2",{id:"user-singularity"},"User Singularity"),(0,i.kt)("p",null,"In every application, one table always stands out as a singularity, typically the User table. Traxion is no exception and must identify the model carrying the user information within it."),(0,i.kt)("p",null,"To use Traxion without special configuration, at least the following minimal user model should be respected:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-prisma"},'model User {\n  id       String    @id @default(uuid())\n  email    String @unique\n  role     String @default("user")\n  /// @trxn/hidden\n  /// @trxn/encrypted\n  password String\n}\n')),(0,i.kt)("p",null,"We'll elaborate on the different metadata used here below."),(0,i.kt)("p",null,"Note: The ",(0,i.kt)("inlineCode",{parentName:"p"},"id")," field here is a string but can also be an Int: ",(0,i.kt)("inlineCode",{parentName:"p"},"id Int @id @default(autoincrement())"),"."),(0,i.kt)("p",null,"Note: The ",(0,i.kt)("inlineCode",{parentName:"p"},"role")," field here is a string but can also be an array of strings ",(0,i.kt)("inlineCode",{parentName:"p"},'roles String[] @default(["user"])'),"."),(0,i.kt)("h2",{id:"user-discovery"},"User Discovery"),(0,i.kt)("p",null,"Traxion tries to identify without any configuration which model in your database schema carries your user information."),(0,i.kt)("p",null,"For this, Traxion first checks if any of your models have the ",(0,i.kt)("inlineCode",{parentName:"p"},"user")," metadata. If yes, this model will be used as the root model to explore your schema's ownership tree. If not, Traxion will try to find a model named ",(0,i.kt)("inlineCode",{parentName:"p"},"user")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"users")," (case does not matter). If nothing is found, certain generators will emit an error (casl)."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-prisma"},"/// @trxn/user\nmodel UserTable {\n  //...\n}\n\nmodel User {\n  // ...\n}\n")),(0,i.kt)("p",null,"Here, Traxion will use the ",(0,i.kt)("inlineCode",{parentName:"p"},"UserTable")," as the root user table."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-prisma"},"model UserTable {\n  //...\n}\n\nmodel User {\n  // ...\n}\n")),(0,i.kt)("p",null,"Here, Traxion will automatically use the ",(0,i.kt)("inlineCode",{parentName:"p"},"User")," table as the root user table."),(0,i.kt)("h2",{id:"ownership"},"Ownership"),(0,i.kt)("p",null,"Traxion tries to automatically discover your data model's dependency tree, starting with the user model. The tree will traverse the model relations. From this, direct and indirect owned models can be detected."),(0,i.kt)("p",null,"An owned model is a model related to the user table. In Traxion, if an entity is owned by a user, the user can read, create, and update it. Otherwise, the user can only read it."),(0,i.kt)("p",null,"Note: You always have the option to use or not to use the generated casl configuration, to use it in whole or in part at your convenience. Traxion will provide you with helpers and try to propose a range of automatic casl configurations. If you are not satisfied, you can opt out of some functionalities and configure as you wish."),(0,i.kt)("p",null,"You can directly tweak some configurations of the casl config with metadata on your models:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"@trxn/ownership:ignore")," Ignore the model and all its relations for ownership detection")),(0,i.kt)("h2",{id:"read-write-delete-authorization"},"Read, Write, Delete Authorization"),(0,i.kt)("p",null,"The ownership tree is used to define the casl ids to fetch for each user and which configuration should be used by default when reading or writing on an owned or unowned model."),(0,i.kt)("p",null,"In your schema, you can add permission configuration to instruct Traxion how it must handle each model with the casl configuration:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"@trxn/permission:allowDelete")," the user"),(0,i.kt)("p",{parentName:"li"},"can read, write, and delete the model")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"@trxn/permission:write")," the user can read and write the model")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"@trxn/permission:readonly")," the user can only read the model")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"@trxn/permission:internal")," the user cannot read and write the model"))),(0,i.kt)("h2",{id:"hidden-and-encrypted-fields"},"Hidden and Encrypted Fields"),(0,i.kt)("p",null,"The hidden metadata on a field allows you to hide this data from the output interface. The input will still request for the field if it is required. This filtering is done in the business layer."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-prisma"},"model User {\n  // ...\n\n  /// @trxn/hidden\n  password String\n\n  // ...\n}\n")),(0,i.kt)("p",null,"The encrypted metadata on a field allows you to encrypt the field (with bcrypt by default) during the update or creation of the business layer."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-prisma"},"model User {\n  // ...\n\n  /// @trxn/encrypted\n  password String\n\n  // ...\n}\n")))}h.isMDXComponent=!0},876:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var r=n(2784);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),d=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=d(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=d(n),m=a,h=p["".concat(s,".").concat(m)]||p[m]||c[m]||i;return n?r.createElement(h,o(o({ref:t},u),{},{components:n})):r.createElement(h,o({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:a,o[1]=l;for(var d=2;d<i;d++)o[d]=n[d];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);